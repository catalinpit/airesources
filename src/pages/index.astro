---
import '../styles/global.css';
import Layout from '../layouts/layout.astro';
import CategoryCard from '../components/ui/Category-Card.astro';
import Tag from '../components/ui/Tag.astro';
import Header from '../components/Header.astro';
import SponsoredProducts from '../components/ui/Sponsored-Products.astro';
import { getCollection } from 'astro:content';

const description = 'A curated collection of the best AI tools, courses, and resources. From code editors to learning platforms, find everything you need to build, learn, and innovate with AI.';

const allCategories = await getCollection('categories');
const allResources = await getCollection('resources');

// Transform resources to include categorySlug for compatibility
const allItems = allResources.map(resource => ({
	...resource.data,
	categorySlug: resource.data.categorySlug
}));

const totalItemsCount = allItems.length;

// Group resources by category for CategoryCard
const resourcesByCategory = allCategories.map(category => {
	const items = allResources
		.filter(r => r.data.categorySlug === category.data.categorySlug)
		.map(r => r.data);
	return {
		...category.data,
		items
	};
});
---

<Layout description={description}>
	<main class="container mx-auto px-4 py-8">
		<Header
			title="AI Resources Directory"
			description={description}
			class="mb-20"
		/>

		<nav class="flex flex-wrap gap-2 justify-center mx-auto mb-12" aria-label="Categories">
			<Tag href="/">
				All ({totalItemsCount})
			</Tag>
			{resourcesByCategory.map((category) => (
				<Tag href={`/category/${category.categorySlug}/`}>
					{category.title} ({category.items.length})
				</Tag>
			))}
		</nav>

		<SponsoredProducts items={allItems} class="w-full" />

		<div class="space-y-16">
			{resourcesByCategory.map((category) => (
				<CategoryCard
					title={category.title}
					description={category.description}
					items={category.items}
					categorySlug={category.categorySlug}
				/>
			))}
		</div>
	</main>
</Layout>

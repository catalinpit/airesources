---
import '../../styles/global.css';
import Layout from '../../layouts/layout.astro';
import { categories } from '../../data/categories';
import Button from '../../components/ui/Button.astro';
import Tag from '../../components/ui/Tag.astro';
import Header from '../../components/Header.astro';
import Divider from '../../components/ui/Divider.astro';
import SponsoredProducts from '../../components/ui/Sponsored-Products.astro';

export async function getStaticPaths() {
  return categories.flatMap(category => 
    category.items.map(item => ({
      params: {
        category: category.categorySlug,
        product: item.name.toLowerCase().replace(/\s+/g, '-'),
      },
      props: {
        category,
        item,
      },
    }))
  );
}

const { category, item } = Astro.props;

const siteUrl = Astro.site || 'https://airesources.dev';
const productUrl = new URL(`/${category.categorySlug}/${item.name.toLowerCase().replace(/\s+/g, '-')}/`, siteUrl).href;
const categoryUrl = new URL(`/category/${category.categorySlug}/`, siteUrl).href;

const tags = [
  { label: item.type || 'tool', href: '#' },
];

const allItems = categories.flatMap(cat => 
  cat.items.map(item => ({
    ...item,
    categorySlug: cat.categorySlug
  }))
);

const filteredItems = allItems.filter(product => 
  product.name !== item.name || product.categorySlug !== category.categorySlug
);
---

<Layout description={item.description} pageTitle={item.name}>
	<script type="application/ld+json" set:html={JSON.stringify({
		"@context": "https://schema.org",
		"@type": "SoftwareApplication",
		"name": item.name,
		"description": item.description,
		...(item.link && { "url": item.link }),
		"applicationCategory": category.title,
		"operatingSystem": "Web",
		"offers": item.pricing ? {
			"@type": "Offer",
			"priceCurrency": "USD",
			"price": item.pricing.type === "free" ? "0" : undefined,
			"priceSpecification": item.pricing.tiers?.map(tier => ({
				"@type": "UnitPriceSpecification",
				"name": tier.name,
				"price": tier.price
			}))
		} : undefined,
		"breadcrumb": {
			"@type": "BreadcrumbList",
			"itemListElement": [
				{
					"@type": "ListItem",
					"position": 1,
					"name": "Resources",
					"item": siteUrl
				},
				{
					"@type": "ListItem",
					"position": 2,
					"name": category.title,
					"item": categoryUrl
				},
				{
					"@type": "ListItem",
					"position": 3,
					"name": item.name,
					"item": productUrl
				}
			]
		}
	})} />
  <div class="container mx-auto px-4 py-12">
    <nav class="max-w-3xl mx-auto mb-6" aria-label="Breadcrumb">
      <ol class="flex items-center gap-2 text-sm text-neutral-600 dark:text-neutral-400" itemscope itemtype="https://schema.org/BreadcrumbList">
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/" class="hover:text-neutral-900 dark:hover:text-neutral-100 transition-colors" itemprop="item">
            <span itemprop="name">Resources</span>
          </a>
          <meta itemprop="position" content="1" />
        </li>
        <span aria-hidden="true">/</span>
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href={`/category/${category.categorySlug}/`} class="hover:text-neutral-900 dark:hover:text-neutral-100 transition-colors" itemprop="item">
            <span itemprop="name">{category.title}</span>
          </a>
          <meta itemprop="position" content="2" />
        </li>
        <span aria-hidden="true">/</span>
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <span class="text-neutral-900 dark:text-neutral-100 font-medium" itemprop="name" aria-current="page">{item.name}</span>
          <meta itemprop="position" content="3" />
        </li>
      </ol>
    </nav>

    {filteredItems.length > 0 && <SponsoredProducts items={filteredItems} class="max-w-3xl mx-auto" />}

    <main>
      <div class="max-w-3xl mx-auto">
        <div class="bg-gradient-to-br from-neutral-50 to-neutral-50/60 dark:from-neutral-800 dark:to-neutral-800/60 rounded-lg shadow-[0_0_0_1px_rgba(0,0,0,0.1)_inset,0_0.5px_0.5px_rgba(0,0,0,0.05)_inset,0_-0.5px_0.5px_rgba(0,0,0,0.05)_inset,0_1px_2px_rgba(0,0,0,0.1),0_4px_12px_-2px_rgba(0,0,0,0.1)] dark:shadow-[0_0_0_0.5px_rgba(255,255,255,0.06)_inset,0_0.5px_0.5px_rgba(255,255,255,0.1)_inset,0_-0.5px_0.5px_rgba(255,255,255,0.1)_inset,0_0.5px_1px_rgba(0,0,0,0.3),0_1px_2px_rgba(0,0,0,0.4),0_4px_12px_-2px_rgba(0,0,0,0.3)]">
          <div class="p-10">
            <div class="relative">
              <div class="float-left mr-4 mb-2">
                <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-white to-neutral-50 dark:from-neutral-800 dark:to-neutral-900 p-2.5 shadow-[0_4px_12px_-2px_rgba(0,0,0,0.1),0_0_0_1px_rgba(0,0,0,0.05)] dark:shadow-[0_4px_12px_-2px_rgba(0,0,0,0.3),0_0_0_1px_rgba(255,255,255,0.05)]">
                  {item.prompt ? (
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-full h-full text-blue-500" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2L13.5 8.5L20 10L13.5 11.5L12 18L10.5 11.5L4 10L10.5 8.5L12 2Z"/>
                      <circle cx="19" cy="5" r="1.5"/>
                      <circle cx="5" cy="19" r="1.5"/>
                      <circle cx="20" cy="19" r="1"/>
                      <circle cx="4" cy="5" r="1"/>
                    </svg>
                  ) : item.iconUrl ? (
                    <img 
                      src={item.iconUrl} 
                      alt={`${item.name} icon`}
                      class="w-full h-full rounded-lg object-contain"
                    />
                  ) : null}
                </div>
              </div>
              <Header
                title={item.name}
                description={item.description}
                class={item.prompt ? "mb-4 text-left" : "mb-0 text-left"}
              />
              <div class="clear-both"></div>
            </div>

            {item.prompt && (
              <>
                {item.tags && item.tags.length > 0 && (
                  <div class="mb-6">
                    <div class="flex flex-wrap items-center gap-2">
                      {item.tags.map(tag => (
                        <span class="relative inline-flex items-center justify-center px-2.5 py-1 rounded-lg text-xs bg-gradient-to-b from-neutral-100 to-neutral-200/50 dark:from-neutral-700/70 dark:to-neutral-800/50 text-neutral-700 dark:text-neutral-200 border border-neutral-300 dark:border-neutral-600 shadow-sm dark:shadow-[0_2px_4px_rgba(0,0,0,0.2)]">
                          #{tag}
                        </span>
                      ))}
                    </div>
                  </div>
                )}
                <Divider class="mb-8" />
                <div class="space-y-4">
                  <h3 class="text-lg font-semibold leading-6 tracking-wide text-neutral-900 dark:text-neutral-100 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                      <polyline points="14 2 14 8 20 8"/>
                      <line x1="16" y1="13" x2="8" y2="13"/>
                      <line x1="16" y1="17" x2="8" y2="17"/>
                      <polyline points="10 9 9 9 8 9"/>
                    </svg>
                    Prompt
                  </h3>
                  <div 
                    class="prompt-content p-6 rounded-xl bg-gradient-to-br from-white to-neutral-50 dark:from-neutral-900 dark:to-neutral-900/80 border border-neutral-200/80 dark:border-neutral-700/80 shadow-[0_2px_4px_rgba(0,0,0,0.05),0_0_0_1px_rgba(0,0,0,0.05)] dark:shadow-[0_2px_4px_rgba(0,0,0,0.2)] text-neutral-900 dark:text-neutral-100 whitespace-pre-line font-mono text-sm"
                  >
                    {item.prompt}
                  </div>
                  {item.example && (
                    <div class="mt-6">
                      <h3 class="text-lg font-semibold leading-6 tracking-wide text-neutral-900 dark:text-neutral-100 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-indigo-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                          <polyline points="14 2 14 8 20 8"/>
                          <line x1="16" y1="13" x2="8" y2="13"/>
                          <line x1="16" y1="17" x2="8" y2="17"/>
                          <polyline points="10 9 9 9 8 9"/>
                        </svg>
                        Usage Example
                      </h3>
                      <div 
                        class="example-content p-6 rounded-xl bg-gradient-to-br from-indigo-50/50 to-indigo-100/30 dark:from-indigo-600/40 dark:to-indigo-500/30 border border-indigo-200/80 dark:border-indigo-600/50 shadow-[0_2px_4px_rgba(0,0,0,0.05),0_0_0_1px_rgba(0,0,0,0.05)] dark:shadow-[0_2px_4px_rgba(0,0,0,0.2)] text-neutral-900 dark:text-neutral-100 whitespace-pre-line font-mono text-sm mt-4"
                      >
                        {item.example}
                      </div>
                    </div>
                  )}
                  {(item.author || item.link) && (
                    <div class="mt-8 pt-8 border-t border-neutral-200/80 dark:border-neutral-700/80 space-y-4">
                      {item.author && (
                        <div class="flex items-center gap-3">
                          {item.author.iconUrl && (
                            <img 
                              src={item.author.iconUrl} 
                              alt={`${item.author.name} avatar`}
                              class="w-10 h-10 rounded-full ring-2 ring-neutral-200 dark:ring-neutral-700"
                            />
                          )}
                          <div>
                            <p class="text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wide mb-1">Created by</p>
                            <a 
                              href={item.author.link} 
                              target="_blank" 
                              rel="noopener noreferrer"
                              class="text-base font-semibold text-neutral-900 dark:text-neutral-100 hover:text-blue-600 dark:hover:text-blue-400 transition-colors inline-flex items-center gap-1.5 group"
                            >
                              <span>{item.author.name}</span>
                              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-60 group-hover:opacity-100 transition-opacity" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.22 14.78a.75.75 0 001.06 0l7.22-7.22v5.69a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75h-7.5a.75.75 0 000 1.5h5.69l-7.22 7.22a.75.75 0 000 1.06z" clip-rule="evenodd" />
                              </svg>
                            </a>
                          </div>
                        </div>
                      )}
                      {item.link && (
                        <div>
                          <a 
                            href={item.link} 
                            target="_blank" 
                            rel="noopener noreferrer"
                            class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors inline-flex items-center gap-1.5"
                          >
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                              <path fill-rule="evenodd" d="M5.22 14.78a.75.75 0 001.06 0l7.22-7.22v5.69a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75h-7.5a.75.75 0 000 1.5h5.69l-7.22 7.22a.75.75 0 000 1.06z" clip-rule="evenodd" />
                            </svg>
                            View source
                          </a>
                        </div>
                      )}
                    </div>
                  )}
                </div>
              </>
            )}

            {!item.prompt && item.models && item.models.length > 0 && (
              <Divider class="my-8" />
              <h3 class="text-lg font-semibold leading-6 tracking-wide text-neutral-900 dark:text-neutral-100 flex items-center gap-2 mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
                Available Models
              </h3>
                <div class="flex flex-wrap gap-2">
                  {item.models.map(model => (
                    <span class="relative inline-flex items-center justify-center px-3 py-1 rounded-lg text-sm bg-gradient-to-b from-neutral-100 to-neutral-200/50 dark:from-neutral-700/70 dark:to-neutral-800/50 text-neutral-700 dark:text-neutral-200 border border-neutral-300 dark:border-neutral-600 shadow-sm dark:shadow-[0_2px_4px_rgba(0,0,0,0.2)]">
                      {model}
                    </span>
                  ))}
                </div>
            )}

            {item.pricing && (
              <div class="space-y-6 mt-8">
                  <h3 class="text-lg font-semibold leading-6 tracking-wide text-neutral-900 dark:text-neutral-100 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                    </svg>
                    Pricing
                  </h3>
                  <span class="relative inline-flex items-center justify-center px-3 py-1 rounded-lg text-sm font-medium bg-gradient-to-b from-neutral-100 to-neutral-200/50 dark:from-neutral-700/70 dark:to-neutral-800/50 text-neutral-700 dark:text-neutral-200 border border-neutral-300 dark:border-neutral-600 shadow-sm dark:shadow-[0_2px_4px_rgba(0,0,0,0.2)]">
                    {item.pricing.type.charAt(0).toUpperCase() + item.pricing.type.slice(1)}
                  </span>
                  <div class="grid gap-3">
                    {item.pricing.tiers.map(tier => (
                      <div class="group relative flex items-center justify-between p-4 rounded-xl bg-gradient-to-br from-white to-neutral-50/50 dark:from-neutral-800/50 dark:to-neutral-800/30 border border-neutral-200/80 dark:border-neutral-700/80 shadow-[0_2px_4px_rgba(0,0,0,0.05),0_0_0_1px_rgba(0,0,0,0.05)] dark:shadow-[0_2px_4px_rgba(0,0,0,0.2)]">
                        <div class="flex items-center gap-3">
                          <div class="flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-blue-50 to-blue-100/50 dark:from-blue-900/20 dark:to-blue-800/20 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                              <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                          </div>
                          <span class="font-medium text-neutral-900 dark:text-neutral-100">{tier.name}</span>
                        </div>
                        <span class="text-sm font-semibold text-neutral-900 dark:text-neutral-100 bg-gradient-to-br from-neutral-100 to-white dark:from-neutral-700/50 dark:to-neutral-800 px-3.5 py-1.5 rounded-full shadow-[0_2px_4px_rgba(0,0,0,0.05)] dark:shadow-[0_2px_4px_rgba(0,0,0,0.2)]">{tier.price}</span>
                      </div>
                    ))}
                  </div>
                  {item.pricing.details && (
                    <div class="flex items-start gap-2.5 text-sm text-neutral-600 dark:text-neutral-400 p-4 rounded-xl">
                      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mt-0.5 flex-shrink-0 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/>
                        <path d="M12 16v-4"/>
                        <path d="M12 8h.01"/>
                      </svg>
                      <span>{item.pricing.details}</span>
                    </div>
                  )}
                </div>
            )}

            {!item.prompt && (
              <div class="flex items-center justify-between mt-10">
                <div class="flex flex-wrap gap-2">
                  {tags.map(tag => (
                    <Tag href={`/category/${category.categorySlug}/`}>
                      #{tag.label}
                    </Tag>
                  ))}
                </div>
                <Button href={item.link} class="inline-flex items-center px-6 py-2.5 bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-medium rounded-xl shadow-[0_2px_4px_rgba(59,130,246,0.3)] hover:shadow-[0_4px_8px_rgba(59,130,246,0.4)] transition-all duration-200">
                  Check out site
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 ml-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.22 14.78a.75.75 0 001.06 0l7.22-7.22v5.69a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75h-7.5a.75.75 0 000 1.5h5.69l-7.22 7.22a.75.75 0 000 1.06z" clip-rule="evenodd" />
                  </svg>
                </Button>
              </div>
            )}
          </div>
        </div>
      </div>
    </main>
  </div>
</Layout>
